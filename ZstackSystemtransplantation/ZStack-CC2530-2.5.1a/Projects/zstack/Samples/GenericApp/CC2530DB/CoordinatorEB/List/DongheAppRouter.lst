###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         01/Dec/2018  10:54:54 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\Junior College\Zigbee development technology    #
#                          and Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\GenericApp\Source\DongheApp #
#                          Router.c                                           #
#    Command line       =  -f "D:\Junior College\Zigbee development           #
#                          technology and Practice\Zstack系统移植\ZStack-CC25 #
#                          30-2.5.1a\Projects\zstack\Samples\GenericApp\CC253 #
#                          0DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg"          #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f "D:\Junior College\Zigbee development           #
#                          technology and Practice\Zstack系统移植\ZStack-CC25 #
#                          30-2.5.1a\Projects\zstack\Samples\GenericApp\CC253 #
#                          0DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"         #
#                          (-DZIGBEEPRO -DSECURE=0 -DZG_SECURE_DYNAMIC=0      #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "D:\Junior College\Zigbee   #
#                          development technology and                         #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\Source\DongheAppRout #
#                          er.c" -D ZTOOL_P1 -D xMT_TASK -D xMT_SYS_FUNC -D   #
#                          xMT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG -lC           #
#                          "D:\Junior College\Zigbee development technology   #
#                          and Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\Coordin #
#                          atorEB\List\" -lA "D:\Junior College\Zigbee        #
#                          development technology and                         #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\Coordinator #
#                          EB\List\" --diag_suppress Pe001,Pa010 -o           #
#                          "D:\Junior College\Zigbee development technology   #
#                          and Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\Coordin #
#                          atorEB\Obj\" -e --no_code_motion --debug           #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "D:\Junior College\Zigbee  #
#                          development technology and                         #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\" -I        #
#                          "D:\Junior College\Zigbee development technology   #
#                          and Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\..\Sour #
#                          ce\" -I "D:\Junior College\Zigbee development      #
#                          technology and Practice\Zstack系统移植\ZStack-CC25 #
#                          30-2.5.1a\Projects\zstack\Samples\GenericApp\CC253 #
#                          0DB\..\..\..\ZMain\TI2530DB\" -I "D:\Junior        #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\hal\include\" -I "D:\Junior         #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\hal\target\CC2530EB\" -I            #
#                          "D:\Junior College\Zigbee development technology   #
#                          and Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\..\..\. #
#                          .\..\..\Components\mac\include\" -I "D:\Junior     #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\high_level\" -I "D:\Junior      #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\mac\low_level\srf04\" -I            #
#                          "D:\Junior College\Zigbee development technology   #
#                          and Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\single_chip #
#                          \" -I "D:\Junior College\Zigbee development        #
#                          technology and Practice\Zstack系统移植\ZStack-CC25 #
#                          30-2.5.1a\Projects\zstack\Samples\GenericApp\CC253 #
#                          0DB\..\..\..\..\..\Components\mt\" -I "D:\Junior   #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\osal\include\" -I "D:\Junior        #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\saddr\" -I "D:\Junior      #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\services\sdata\" -I "D:\Junior      #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\af\" -I "D:\Junior            #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\nwk\" -I "D:\Junior           #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sapi\" -I "D:\Junior          #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sec\" -I "D:\Junior           #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sys\" -I "D:\Junior           #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\zdo\" -I "D:\Junior           #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\zmac\" -I "D:\Junior                #
#                          College\Zigbee development technology and          #
#                          Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Samples\GenericApp\CC2530DB\..\..\..\.. #
#                          \..\Components\zmac\f8w\" -Ohz                     #
#                          --require_prototypes                               #
#    List file          =  D:\Junior College\Zigbee development technology    #
#                          and Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\Coordin #
#                          atorEB\List\DongheAppRouter.lst                    #
#    Object file        =  D:\Junior College\Zigbee development technology    #
#                          and Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\Coordin #
#                          atorEB\Obj\DongheAppRouter.r51                     #
#                                                                             #
#                                                                             #
###############################################################################

D:\Junior College\Zigbee development technology and Practice\Zstack系统移植\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\GenericApp\Source\DongheAppRouter.c
      1          
      2          #include "DongheApp.h"
      3          #include "OSAL_DongheRouter.h"
      4          #include "hal_lcd.h"
      5          #include "hal_led.h"
      6          #include "hal_key.h"
      7          #include "hal_uart.h"
      8          #include "OnBoard.h"
      9          #include "OSAL.h"
     10          #include "AF.h"
     11          #include "ZDApp.h"
     12          #include "ZDObject.h"
     13          #include "ZDProfile.h"
     14          #include "DebugTrace.h"
     15          
     16          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     17          byte DhAppRouterManage_TaskID;   // Task ID for internal task/event processing
   \                     DhAppRouterManage_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     18                                    // This variable will be received when
     19                                    // DhAppRouterManage_Init() is called.

   \                                 In  segment XDATA_I, align 1, keep-with-next
     20          devStates_t DhAppRouterManage_NwkState=DEV_INIT;   //devStates_t; //DEV_INIT
   \                     DhAppRouterManage_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for DhAppRouterManage_NwkState>`
   \   000001                REQUIRE __INIT_XDATA_I
     21          
     22          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     23          byte DhAppRouterManage_TransID=0;  // This is the unique message ID (counter)
   \                     DhAppRouterManage_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     24          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     25          afAddrType_t MySendtest_Single_DstAddr;
   \                     MySendtest_Single_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     26          endPointDesc_t  MySendtest_epDesc;
   \                     MySendtest_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
     27          
     28          
     29          /*********************************************************************
     30           * LOCAL FUNCTIONS
     31           */
     32          void DhAppRouterManage_ProcessZDOStateChange( void );
     33          void DhAppRouterManage_ProcessMSGData( afIncomingMSGPacket_t *msg );
     34          void DhAppRouterManage_HandleKeys(byte keys );
     35          
     36          /*********************************************************************
     37           * NETWORK LAYER CALLBACKS
     38           */
     39          
     40          /*********************************************************************
     41           * PUBLIC FUNCTIONS
     42           */
     43          
     44          /*********************************************************************
     45           * @fn      DhAppRouterManage_Init
     46           *
     47           * @brief   Initialization function for the Generic App Task.
     48           *          This is called during initialization and should contain
     49           *          any application specific initialization (ie. hardware
     50           *          initialization/setup, table initialization, power up
     51           *          notificaiton ... ).
     52           *
     53           * @param   task_id - the ID assigned by OSAL.  This ID should be
     54           *                    used to send messages and set timers.
     55           *
     56           * @return  none
     57           */
     58          

   \                                 In  segment XDATA_ROM_C, align 1
     59          const uint16 MySendtest_INClusterList[MySendtest_MAX_OUTCLUSTERS]=
   \                     MySendtest_INClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
   \   000004   0300         DW 3
   \   000006   0400         DW 4
     60          {
     61            MySendtest_PERIODIC_CLUSTERID,
     62            MySendtest_GUANG_CLUSTERID,
     63            MySendtest_WENDU_CLUSTERID,
     64            MySendtest_SHIDU_CLUSTERID
     65          };
     66          

   \                                 In  segment XDATA_ROM_C, align 1
     67          const uint16 MySendtest_OUTClusterList[MySendtest_MAX_INCLUSTERS]=
   \                     MySendtest_OUTClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
   \   000004   0300         DW 3
   \   000006   0400         DW 4
     68          {
     69            MySendtest_SINGLE_CLUSTERID,
     70            MySendtest_REGUANG_CLUSTERID,
     71            MySendtest_REWENDU_CLUSTERID,
     72            MySendtest_RESHIDU_CLUSTERID
     73          };
     74          

   \                                 In  segment XDATA_ROM_C, align 1
     75          const SimpleDescriptionFormat_t MySendtest_SimpleDesc=
   \                     MySendtest_SimpleDesc:
   \   000000   10           DB 16
   \   000001   080F         DW 3848
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   04           DB 4
   \   000007   ....         DW MySendtest_INClusterList
   \   000009   04           DB 4
   \   00000A   ....         DW MySendtest_OUTClusterList
     76          {
     77            MySendtest_ENDPOINT,
     78            MySendtest_PROFID,
     79            MySendtest_DEVICEID,
     80            MySendtest_DEVICE_VERSION,
     81            MySendtest_FLAGS,
     82            MySendtest_MAX_INCLUSTERS,
     83            (uint16*)MySendtest_INClusterList,
     84            MySendtest_MAX_OUTCLUSTERS,
     85            (uint16*)MySendtest_OUTClusterList
     86          };
     87          
     88          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     89          void DongheAppRouter_Init(uint8 task_id)
   \                     DongheAppRouter_Init:
     90          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
     91            DhAppRouterManage_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#DhAppRouterManage_TaskID
   \   000009   F0           MOVX    @DPTR,A
     92            MySendtest_Single_DstAddr.addrMode=afAddr16Bit;
   \   00000A   90....       MOV     DPTR,#MySendtest_Single_DstAddr + 8
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
     93            MySendtest_Single_DstAddr.endPoint=MySendtest_ENDPOINT;
   \   000010   A3           INC     DPTR
   \   000011   7410         MOV     A,#0x10
   \   000013   F0           MOVX    @DPTR,A
     94            MySendtest_Single_DstAddr.addr.shortAddr=0x0000;
   \   000014   90....       MOV     DPTR,#MySendtest_Single_DstAddr
   \   000017   E4           CLR     A
   \   000018   F0           MOVX    @DPTR,A
   \   000019   A3           INC     DPTR
   \   00001A   F0           MOVX    @DPTR,A
     95          
     96          
     97            //DhAppRouterManage_TransID = 0;
     98            MySendtest_epDesc.endPoint=MySendtest_ENDPOINT;
   \   00001B   90....       MOV     DPTR,#MySendtest_epDesc
   \   00001E   7410         MOV     A,#0x10
   \   000020   F0           MOVX    @DPTR,A
     99            MySendtest_epDesc.task_id=&DhAppRouterManage_TaskID;
   \   000021   A3           INC     DPTR
   \   000022   74..         MOV     A,#DhAppRouterManage_TaskID & 0xff
   \   000024   F0           MOVX    @DPTR,A
   \   000025   A3           INC     DPTR
   \   000026   74..         MOV     A,#(DhAppRouterManage_TaskID >> 8) & 0xff
   \   000028   F0           MOVX    @DPTR,A
    100            MySendtest_epDesc.simpleDesc=(SimpleDescriptionFormat_t *)&MySendtest_SimpleDesc ;
   \   000029   A3           INC     DPTR
   \   00002A   74..         MOV     A,#MySendtest_SimpleDesc & 0xff
   \   00002C   F0           MOVX    @DPTR,A
   \   00002D   A3           INC     DPTR
   \   00002E   74..         MOV     A,#(MySendtest_SimpleDesc >> 8) & 0xff
   \   000030   F0           MOVX    @DPTR,A
    101            MySendtest_epDesc.latencyReq=noLatencyReqs;
   \   000031   A3           INC     DPTR
   \   000032   E4           CLR     A
   \   000033   F0           MOVX    @DPTR,A
    102          
    103          
    104            afRegister(&MySendtest_epDesc);
   \   000034                ; Setup parameters for call to function afRegister
   \   000034   7A..         MOV     R2,#MySendtest_epDesc & 0xff
   \   000036   7B..         MOV     R3,#(MySendtest_epDesc >> 8) & 0xff
   \   000038   12....       LCALL   ??afRegister?relay
    105            RegisterForKeys(DhAppRouterManage_TaskID);
   \   00003B                ; Setup parameters for call to function RegisterForKeys
   \   00003B   90....       MOV     DPTR,#DhAppRouterManage_TaskID
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   F9           MOV     R1,A
   \   000040   12....       LCALL   ??RegisterForKeys?relay
    106          }
   \   000043   7F01         MOV     R7,#0x1
   \   000045   02....       LJMP    ?BANKED_LEAVE_XDATA
    107          
    108          /*********************************************************************
    109           * @fn      DhAppRouterManage_ProcessEvent
    110           *
    111           * @brief   Generic Application Task event processor.  This function
    112           *          is called to process all events for the task.  Events
    113           *          include timers, messages and any other user defined events.
    114           *
    115           * @param   task_id  - The OSAL assigned task ID.
    116           * @param   events - events to process.  This is a bit map and can
    117           *                   contain more than one event.
    118           *
    119           * @return  none
    120           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    121          uint16 DongheAppRouter_ProcessEvent( uint8 task_id, uint16 events )
   \                     DongheAppRouter_ProcessEvent:
    122          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    123            afIncomingMSGPacket_t *MSGpkt;
    124            //afDataConfirm_t *afDataConfirm;
    125          
    126            // Data Confirmation message fields
    127            //byte sentEP;
    128            //ZStatus_t sentStatus;
    129            //byte sentTransID;       // This should match the value sent
    130            (void)task_id;  // Intentionally unreferenced parameter
    131          
    132            if ( events & SYS_EVENT_MSG )
   \   000009   EB           MOV     A,R3
   \   00000A   5480         ANL     A,#0x80
   \   00000C   6052         JZ      ??DongheAppRouter_ProcessEvent_0
    133            {
    134              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( DhAppRouterManage_TaskID );
   \   00000E                ; Setup parameters for call to function osal_msg_receive
   \   00000E   8033         SJMP    ??DongheAppRouter_ProcessEvent_1
    135              while ( MSGpkt )
    136              {
    137                switch ( MSGpkt->hdr.event )
   \                     ??DongheAppRouter_ProcessEvent_2:
   \   000010   8E82         MOV     DPL,R6
   \   000012   8F83         MOV     DPH,R7
   \   000014   E0           MOVX    A,@DPTR
   \   000015   64D1         XRL     A,#0xd1
   \   000017   7023         JNZ     ??DongheAppRouter_ProcessEvent_3
    138                {
    139                  case KEY_CHANGE:
    140                    DhAppRouterManage_HandleKeys(((keyChange_t *)MSGpkt)->keys );
    141                    break;
    142          
    143                  case AF_INCOMING_MSG_CMD:
    144                    DhAppRouterManage_ProcessMSGData(MSGpkt);
    145                    break;
    146          
    147                  case ZDO_STATE_CHANGE:
    148                    DhAppRouterManage_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \   000019   A3           INC     DPTR
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   90....       MOV     DPTR,#DhAppRouterManage_NwkState
   \   00001E   F0           MOVX    @DPTR,A
    149                    //GenericApp_NwkState == DEV_ROUTER
    150                    //GenericApp_NwkState == DEV_END_DEVICE
    151                    if (DhAppRouterManage_NwkState == DEV_ROUTER || DhAppRouterManage_NwkState == DEV_END_DEVICE)
   \   00001F   6407         XRL     A,#0x7
   \   000021   6005         JZ      ??DongheAppRouter_ProcessEvent_4
   \   000023   E0           MOVX    A,@DPTR
   \   000024   6406         XRL     A,#0x6
   \   000026   7014         JNZ     ??DongheAppRouter_ProcessEvent_3
    152                    {
    153                      HalLedSet (HAL_LED_1, HAL_LED_MODE_OFF);
   \                     ??DongheAppRouter_ProcessEvent_4:
   \   000028                ; Setup parameters for call to function HalLedSet
   \   000028   7A00         MOV     R2,#0x0
   \   00002A   7901         MOV     R1,#0x1
   \   00002C   12....       LCALL   ??HalLedSet?relay
    154                      HalLedBlink(HAL_LED_2,5,50,1000);
   \   00002F                ; Setup parameters for call to function HalLedBlink
   \   00002F   7CE8         MOV     R4,#-0x18
   \   000031   7D03         MOV     R5,#0x3
   \   000033   7B32         MOV     R3,#0x32
   \   000035   7A05         MOV     R2,#0x5
   \   000037   7902         MOV     R1,#0x2
   \   000039   12....       LCALL   ??HalLedBlink?relay
    155                      //DhAppRouterManage_ProcessZDOStateChange();
    156                    }
    157                    break;
    158          
    159                  default:
    160                    break;
    161                }
    162          
    163                // Release the memory
    164                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??DongheAppRouter_ProcessEvent_3:
   \   00003C                ; Setup parameters for call to function osal_msg_deallocate
   \   00003C   EE           MOV     A,R6
   \   00003D   FA           MOV     R2,A
   \   00003E   EF           MOV     A,R7
   \   00003F   FB           MOV     R3,A
   \   000040   12....       LCALL   ??osal_msg_deallocate?relay
    165          
    166                // Next
    167                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( DhAppRouterManage_TaskID );
   \   000043                ; Setup parameters for call to function osal_msg_receive
   \                     ??DongheAppRouter_ProcessEvent_1:
   \   000043   90....       MOV     DPTR,#DhAppRouterManage_TaskID
   \   000046   E0           MOVX    A,@DPTR
   \   000047   F9           MOV     R1,A
   \   000048   12....       LCALL   ??osal_msg_receive?relay
   \   00004B   8A..         MOV     ?V0 + 2,R2
   \   00004D   8B..         MOV     ?V0 + 3,R3
   \   00004F   AE..         MOV     R6,?V0 + 2
   \   000051   AF..         MOV     R7,?V0 + 3
    168              }
   \   000053   EE           MOV     A,R6
   \   000054   4F           ORL     A,R7
   \   000055   70B9         JNZ     ??DongheAppRouter_ProcessEvent_2
    169          
    170              // return unprocessed events
    171              return (events ^ SYS_EVENT_MSG);
   \   000057   AA..         MOV     R2,?V0 + 0
   \   000059   E5..         MOV     A,?V0 + 1
   \   00005B   6480         XRL     A,#0x80
   \   00005D   FB           MOV     R3,A
   \   00005E   8004         SJMP    ??DongheAppRouter_ProcessEvent_5
    172            }
    173          
    174            return 0;
   \                     ??DongheAppRouter_ProcessEvent_0:
   \   000060   7A00         MOV     R2,#0x0
   \   000062   7B00         MOV     R3,#0x0
   \                     ??DongheAppRouter_ProcessEvent_5:
   \   000064   7F04         MOV     R7,#0x4
   \   000066   02....       LJMP    ?BANKED_LEAVE_XDATA
    175          }
    176          
    177          /*********************************************************************
    178           * Event Generation Functions
    179           */
    180          
    181          /*********************************************************************
    182           * @fn      DhAppRouterManage_ProcessZDOMsgs()
    183           *
    184           * @brief   Process response messages
    185           *
    186           * @param   none
    187           *
    188           * @return  none
    189           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    190          void DhAppRouterManage_ProcessZDOStateChange()
   \                     DhAppRouterManage_ProcessZDOStateChange:
    191          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    192          
    193          }
   \   000000   02....       LJMP    ?BRET
    194          
    195          /*********************************************************************
    196           * @fn      DhAppRouterManage_HandleKeys
    197           *
    198           * @brief   Handles all key events for this device.
    199           *
    200           * @param   shift - true if in shift/alt.
    201           * @param   keys - bit field for key events. Valid entries:
    202           *                 HAL_KEY_SW_4
    203           *                 HAL_KEY_SW_3
    204           *                 HAL_KEY_SW_2
    205           *                 HAL_KEY_SW_1
    206           *
    207           * @return  none
    208           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    209          void DhAppRouterManage_HandleKeys(byte keys)
   \                     DhAppRouterManage_HandleKeys:
    210          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    211          
    212            // Shift is used to make each button/switch dual purpose.
    213              if ( keys & HAL_KEY_SW_1 )
    214              {
    215              }
    216          
    217              if ( keys & HAL_KEY_SW_3 )
    218              {
    219              }
    220          
    221              if ( keys & HAL_KEY_SW_4 )
    222              {
    223              }
    224              if ( keys & HAL_KEY_SW_5 )
    225              {
    226              }
    227              if ( keys & HAL_KEY_SW_6 )
    228              {
    229              }
    230          }
   \   000000   02....       LJMP    ?BRET
    231          
    232          /*********************************************************************
    233           * LOCAL FUNCTIONS
    234           */
    235          
    236          /*********************************************************************
    237           * @fn      DhAppRouterManage_MessageMSGCB
    238           *
    239           * @brief   Data message processor callback.  This function processes
    240           *          any incoming data - probably from other devices.  So, based
    241           *          on cluster ID, perform the intended action.
    242           *
    243           * @param   none
    244           *
    245           * @return  none
    246           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    247          void DhAppRouterManage_ProcessMSGData( afIncomingMSGPacket_t *msg )
   \                     DhAppRouterManage_ProcessMSGData:
    248          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    249            switch ( msg->clusterId )
    250            {
    251              case MySendtest_PERIODIC_CLUSTERID:
    252                break;
    253          
    254              case MySendtest_WENDU_CLUSTERID:
    255                break;
    256          
    257              case MySendtest_GUANG_CLUSTERID:
    258                break;
    259          
    260              case MySendtest_SHIDU_CLUSTERID:
    261                break;
    262          
    263              default:
    264                break;
    265          
    266            }
    267          }
   \   000000   02....       LJMP    ?BRET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for DhAppRouterManage_NwkState>`:
   \   000000   01           DB 1

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??DongheAppRouter_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    DongheAppRouter_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??DongheAppRouter_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    DongheAppRouter_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??DhAppRouterManage_ProcessZDOStateChange?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    DhAppRouterManage_ProcessZDOStateChange

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??DhAppRouterManage_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    DhAppRouterManage_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??DhAppRouterManage_ProcessMSGData?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    DhAppRouterManage_ProcessMSGData

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     DhAppRouterManage_HandleKeys       0      0      0
     DhAppRouterManage_ProcessMSGData
                                        0      0      0
     DhAppRouterManage_ProcessZDOStateChange
                                        0      0      0
     DongheAppRouter_Init               0      0      9
       -> afRegister                    0      0     18
       -> RegisterForKeys               0      0     18
     DongheAppRouter_ProcessEvent       0      0     12
       -> osal_msg_receive              0      0     24
       -> HalLedSet                     0      0     24
       -> HalLedBlink                   0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24


   Segment part sizes:

     Function/Label                                  Bytes
     --------------                                  -----
     DhAppRouterManage_TaskID                           1
     DhAppRouterManage_NwkState                         1
     DhAppRouterManage_TransID                          1
     MySendtest_Single_DstAddr                         12
     MySendtest_epDesc                                  6
     MySendtest_INClusterList                           8
     MySendtest_OUTClusterList                          8
     MySendtest_SimpleDesc                             12
     DongheAppRouter_Init                              72
     DongheAppRouter_ProcessEvent                     105
     DhAppRouterManage_ProcessZDOStateChange
                                                        3
     DhAppRouterManage_HandleKeys                       3
     DhAppRouterManage_ProcessMSGData
                                                        3
     ?<Initializer for DhAppRouterManage_NwkState>      1
     ??DongheAppRouter_Init?relay                       6
     ??DongheAppRouter_ProcessEvent?relay               6
     ??DhAppRouterManage_ProcessZDOStateChange?relay    6
     ??DhAppRouterManage_HandleKeys?relay               6
     ??DhAppRouterManage_ProcessMSGData?relay           6

 
 186 bytes in segment BANKED_CODE
  30 bytes in segment BANK_RELAYS
   1 byte  in segment XDATA_I
   1 byte  in segment XDATA_ID
  28 bytes in segment XDATA_ROM_C
  20 bytes in segment XDATA_Z
 
 217 bytes of CODE  memory
  28 bytes of CONST memory
  21 bytes of XDATA memory

Errors: none
Warnings: none
